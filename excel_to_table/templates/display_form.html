{%load static %}
<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <link rel="stylesheet" href="{% static 'css/bootstrap.css' %}">
    <link rel="stylesheet" href="{% static 'css/fontawesome.css' %}">
    <link rel="stylesheet" href="{% static 'css/style.css' %}">
    <link rel="stylesheet" href="{% static 'css/responsive.css' %}">
    
    <title>Excel Reader</title>
    

    <style>
        table {
            border-collapse: collapse;
            width: 100%;
        }

        th, td {
            border: 1px solid black;
            padding: 8px;
            text-align: left;
        }

        th {
            background-color: #ffffff;
        }

        td.editable {
            background-color: #eaf4ff; /* Background color for editable cells */
        }
    </style>
    
</head>
<body>
    {% include "header.html" %}
    <div class="container-fluid bg-white">
        <h1 class="text-white">Excel Data</h1>
    <button type="submit" class="btn btn-primary">Next</button>
    <button class='btn btn-primary' onclick="saveChanges()">Save Changes</button>
    <form method="post" enctype="multipart/form-data" action="{% url 'savedata' %}">
      {% csrf_token %}
      <table class="table table-striped" id="myTable">
        <thead>
          <tr>
            <th scope="col">Sr.no</th>
            <th scope="col">step</th>
            <th scope="col">Description</th>
            <th scope="col">std.value</th>
            <th scope="col">obs.value</th>
            <th scope="col">start_time</th>
            <th scope="col">end_time</th>
            <th scope="col">created_by</th>
            <th scope="col">user_permission</th>
          </tr>
        </thead>
        <tbody>
    {% for data in edittemplate  %}

      {% csrf_token %}
      <tr>
        <td>{{ forloop.counter }}</td>
        <td>{{ data.step }}</td>
        <td>{{ data.description }}</td>
        <td><input type="text" name="std_value" value="{{ data.std_value }}"></td>
        <td>{{ data.obs_value }}</td>
        <td>{{ data.start_time }}</td>
        <td>{{ data.end_time }}</td>
        <td>{{ data.creator }}</td>
        
        <td style="width: 10%;" >
          <img src="/static/images/u.png" alt="#" height="25%" width="25%" style="margin-right: 10px;"/>
          <img src="/static/images/d.png" alt="#" height="25%" width="25%"/>
      </td>
      
      </tr>
    {% endfor %}
    </form>


    <table id="myTable">
        <tr>
            {% for column in data.columns %}
            <th>{{ column }}</th>
            {% endfor %}
        </tr>
        {% for row in data.values %}
        <tr>
            {% for cell in row %}
            <td class="editable" onclick="makeEditable(this)" contenteditable="true" oninput="checkInput(this)">{{ cell }}</td>
            {% endfor %}
        </tr>
        {% endfor %}
    </table>
    
    
    <script src="{% static 'js/xlsx.full.min.js' %}"></script> <!-- Include SheetJS library -->
    
    
    
    <button onclick="saveChanges()">Save Changes</button>

    </div>
    
    <script>
        new DataTable('#myTable');
        function checkInput(cell) {
          const userInput = cell.textContent.trim();
          const rangeValues = userInput.split('-');
      
          if (rangeValues.length === 2) {
            const minValue = parseFloat(rangeValues[0]);
            const maxValue = parseFloat(rangeValues[1]);
      
            const value = parseFloat(cell.textContent);
            if (!isNaN(value)) {
              if (value < minValue) {
                cell.style.backgroundColor = 'yellow';
              } else if (value > maxValue) {
                cell.style.backgroundColor = 'red';
              } else {
                cell.style.backgroundColor = 'green';
              }
            } else {
              // Handle invalid input
              cell.style.backgroundColor = 'yellow';
            }
          } else {
            const singleValue = parseFloat(userInput);
            if (!isNaN(singleValue)) {
              // Handle single values
              cell.style.backgroundColor = 'yellow';
            } else {
              // Handle invalid input
              cell.style.backgroundColor = 'yellow';
            }
          }
        }
      
        function makeEditable(cell) {
          cell.setAttribute('contenteditable', true);
          cell.classList.add('editable');
          cell.focus();
        }
      
        function saveChanges() {
          const rows = document.querySelectorAll('table tbody tr');
          const data = [];
          rows.forEach(row => {
            const rowData = [];
            row.querySelectorAll('td').forEach((cell, index) => {
              if (index === 2) {
                // Only modify the third column (index 2)
                rowData.push(cell.textContent);
                // Reset background color after saving changes
                cell.style.backgroundColor = '';
              } else {
                rowData.push(cell.innerText);
              }
            });
            data.push(rowData);
          });
      
          // Now 'data' contains the modified values in the third column
          console.log(data);
      
          // Show a pop-up notification
          alert('Changes saved successfully!');
        }
        
      </script>
      
      
      
    <script src="{% static 'js/jquery.min.js' %}"></script>
    <script src="{% static 'js/bootstrap.js' %}"></script>
    <script src="{% static 'js/fontawesome.js' %}"></script>
    <script src="{% static 'js/custom.js' %}"></script>
</body>
</html>
